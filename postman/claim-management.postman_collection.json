{
  "info": {
    "name": "Claim Management API",
    "description": "API REST para la gestión integral de reclamos de clientes bancarios",
    "version": "1.0.0",
    "_postman_id": "claim-management-api-collection",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "https://api.banco.com/v1",
      "description": "Base URL del servidor de producción"
    },
    {
      "key": "devUrl",
      "value": "https://api-dev.banco.com/v1",
      "description": "Base URL del servidor de desarrollo"
    },
    {
      "key": "claimId",
      "value": "CLM-2024-001234",
      "description": "ID de reclamo para pruebas"
    }
  ],
  "item": [
    {
      "name": "Claims",
      "description": "Operaciones para la gestión de reclamos de clientes",
      "item": [
        {
          "name": "Crear un nuevo reclamo",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              },
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"date\": \"2024-11-08T10:30:00Z\",\n  \"amount\": 1500.75,\n  \"identityDocument\": \"12345678\",\n  \"description\": \"Cargo no autorizado en mi tarjeta de crédito por compra que no realicé\",\n  \"reason\": \"Cargo indebido\",\n  \"subReason\": \"Transacción no autorizada\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/claims",
              "host": ["{{baseUrl}}"],
              "path": ["claims"]
            },
            "description": "Crea un nuevo reclamo de cliente con todos los detalles requeridos. El sistema asigna automáticamente un ID único y establece el estado inicial como 'open'."
          },
          "response": [
            {
              "name": "Reclamo creado exitosamente",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Accept",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"date\": \"2024-11-08T10:30:00Z\",\n  \"amount\": 1500.75,\n  \"identityDocument\": \"12345678\",\n  \"description\": \"Cargo no autorizado en mi tarjeta de crédito por compra que no realicé\",\n  \"reason\": \"Cargo indebido\",\n  \"subReason\": \"Transacción no autorizada\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/claims",
                  "host": ["{{baseUrl}}"],
                  "path": ["claims"]
                }
              },
              "status": "Created",
              "code": 201,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\n  \"id\": \"CLM-2024-001234\",\n  \"date\": \"2024-11-08T10:30:00Z\",\n  \"amount\": 1500.75,\n  \"identityDocument\": \"12345678\",\n  \"description\": \"Cargo no autorizado en mi tarjeta de crédito por compra que no realicé\",\n  \"reason\": \"Cargo indebido\",\n  \"subReason\": \"Transacción no autorizada\",\n  \"status\": \"open\",\n  \"comments\": null,\n  \"createdAt\": \"2024-11-08T10:30:00Z\",\n  \"updatedAt\": \"2024-11-08T10:30:00Z\"\n}"
            },
            {
              "name": "Error de validación",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"date\": \"2024-11-08T10:30:00Z\",\n  \"amount\": -100,\n  \"description\": \"Test\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/claims",
                  "host": ["{{baseUrl}}"],
                  "path": ["claims"]
                }
              },
              "status": "Bad Request",
              "code": 400,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\n  \"error\": \"Validation Error\",\n  \"message\": \"Los campos requeridos no están completos\",\n  \"details\": [\n    {\n      \"field\": \"identityDocument\",\n      \"message\": \"El documento de identidad es requerido\"\n    },\n    {\n      \"field\": \"amount\",\n      \"message\": \"El monto debe ser mayor a 0\"\n    },\n    {\n      \"field\": \"description\",\n      \"message\": \"La descripción debe tener al menos 10 caracteres\"\n    }\n  ]\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Response is a valid claim object\", function () {",
                  "    pm.response.to.be.json;",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('date');",
                  "    pm.expect(jsonData).to.have.property('amount');",
                  "    pm.expect(jsonData).to.have.property('identityDocument');",
                  "    pm.expect(jsonData).to.have.property('description');",
                  "    pm.expect(jsonData).to.have.property('reason');",
                  "    pm.expect(jsonData).to.have.property('subReason');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('createdAt');",
                  "    pm.expect(jsonData).to.have.property('updatedAt');",
                  "});",
                  "",
                  "pm.test(\"Claim has correct initial status\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.equal('open');",
                  "});",
                  "",
                  "pm.test(\"Claim ID is generated\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.match(/^CLM-\\d{4}-\\d{6}$/);",
                  "});",
                  "",
                  "pm.test(\"Amount matches request\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.amount).to.equal(1500.75);",
                  "});",
                  "",
                  "// Store claim ID for subsequent tests",
                  "if (pm.response.code === 201) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.environment.set('claimId', jsonData.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Obtener lista de reclamos",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/claims?page=1&limit=20&status=open",
              "host": ["{{baseUrl}}"],
              "path": ["claims"],
              "query": [
                {
                  "key": "identityDocument",
                  "value": "12345678",
                  "description": "Filtrar por documento de identidad del cliente",
                  "disabled": true
                },
                {
                  "key": "page",
                  "value": "1",
                  "description": "Número de página (empezando en 1)"
                },
                {
                  "key": "limit",
                  "value": "20",
                  "description": "Número de elementos por página"
                },
                {
                  "key": "status",
                  "value": "open",
                  "description": "Filtrar por estado del reclamo"
                }
              ]
            },
            "description": "Obtiene una lista paginada de reclamos con filtros opcionales por documento de identidad, estado y paginación."
          },
          "response": [
            {
              "name": "Lista de reclamos obtenida exitosamente",
              "originalRequest": {
                "method": "GET",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/claims?page=1&limit=20",
                  "host": ["{{baseUrl}}"],
                  "path": ["claims"],
                  "query": [
                    {
                      "key": "page",
                      "value": "1"
                    },
                    {
                      "key": "limit",
                      "value": "20"
                    }
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\n  \"data\": [\n    {\n      \"id\": \"CLM-2024-001234\",\n      \"date\": \"2024-11-08T10:30:00Z\",\n      \"amount\": 1500.75,\n      \"identityDocument\": \"12345678\",\n      \"description\": \"Cargo no autorizado en mi tarjeta de crédito\",\n      \"reason\": \"Cargo indebido\",\n      \"subReason\": \"Transacción no autorizada\",\n      \"status\": \"open\",\n      \"comments\": null,\n      \"createdAt\": \"2024-11-08T10:30:00Z\",\n      \"updatedAt\": \"2024-11-08T10:30:00Z\"\n    },\n    {\n      \"id\": \"CLM-2024-001235\",\n      \"date\": \"2024-11-07T14:15:00Z\",\n      \"amount\": 250.00,\n      \"identityDocument\": \"87654321\",\n      \"description\": \"Error en el cálculo de intereses en mi cuenta de ahorros\",\n      \"reason\": \"Error en cálculos\",\n      \"subReason\": \"Intereses mal calculados\",\n      \"status\": \"inProgress\",\n      \"comments\": \"En revisión por el área técnica\",\n      \"createdAt\": \"2024-11-07T14:15:00Z\",\n      \"updatedAt\": \"2024-11-08T09:20:00Z\"\n    }\n  ],\n  \"pagination\": {\n    \"page\": 1,\n    \"limit\": 20,\n    \"total\": 2,\n    \"totalPages\": 1\n  }\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has required structure\", function () {",
                  "    pm.response.to.be.json;",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('data');",
                  "    pm.expect(jsonData).to.have.property('pagination');",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "});",
                  "",
                  "pm.test(\"Pagination has required fields\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    const pagination = jsonData.pagination;",
                  "    pm.expect(pagination).to.have.property('page');",
                  "    pm.expect(pagination).to.have.property('limit');",
                  "    pm.expect(pagination).to.have.property('total');",
                  "    pm.expect(pagination).to.have.property('totalPages');",
                  "});",
                  "",
                  "pm.test(\"Each claim has required fields\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    jsonData.data.forEach(claim => {",
                  "        pm.expect(claim).to.have.property('id');",
                  "        pm.expect(claim).to.have.property('date');",
                  "        pm.expect(claim).to.have.property('amount');",
                  "        pm.expect(claim).to.have.property('identityDocument');",
                  "        pm.expect(claim).to.have.property('description');",
                  "        pm.expect(claim).to.have.property('reason');",
                  "        pm.expect(claim).to.have.property('subReason');",
                  "        pm.expect(claim).to.have.property('status');",
                  "        pm.expect(claim.status).to.be.oneOf(['open', 'inProgress', 'resolved']);",
                  "    });",
                  "});",
                  "",
                  "pm.test(\"Page count is correct\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    const expectedPages = Math.ceil(jsonData.pagination.total / jsonData.pagination.limit);",
                  "    pm.expect(jsonData.pagination.totalPages).to.equal(expectedPages);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Obtener detalles de reclamo específico",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/claims/{{claimId}}",
              "host": ["{{baseUrl}}"],
              "path": ["claims", "{{claimId}}"]
            },
            "description": "Obtiene todos los detalles de un reclamo específico por su ID único."
          },
          "response": [
            {
              "name": "Detalles del reclamo obtenidos exitosamente",
              "originalRequest": {
                "method": "GET",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/claims/CLM-2024-001234",
                  "host": ["{{baseUrl}}"],
                  "path": ["claims", "CLM-2024-001234"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\n  \"id\": \"CLM-2024-001234\",\n  \"date\": \"2024-11-08T10:30:00Z\",\n  \"amount\": 1500.75,\n  \"identityDocument\": \"12345678\",\n  \"description\": \"Cargo no autorizado en mi tarjeta de crédito por compra que no realicé en tienda online\",\n  \"reason\": \"Cargo indebido\",\n  \"subReason\": \"Transacción no autorizada\",\n  \"status\": \"inProgress\",\n  \"comments\": \"Se ha iniciado la investigación con el comercio correspondiente\",\n  \"createdAt\": \"2024-11-08T10:30:00Z\",\n  \"updatedAt\": \"2024-11-08T15:45:00Z\"\n}"
            },
            {
              "name": "Reclamo no encontrado",
              "originalRequest": {
                "method": "GET",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/claims/CLM-INVALID",
                  "host": ["{{baseUrl}}"],
                  "path": ["claims", "CLM-INVALID"]
                }
              },
              "status": "Not Found",
              "code": 404,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\n  \"error\": \"Claim Not Found\",\n  \"message\": \"El reclamo con ID CLM-INVALID no existe\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response is a valid claim object\", function () {",
                  "    pm.response.to.be.json;",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('date');",
                  "    pm.expect(jsonData).to.have.property('amount');",
                  "    pm.expect(jsonData).to.have.property('identityDocument');",
                  "    pm.expect(jsonData).to.have.property('description');",
                  "    pm.expect(jsonData).to.have.property('reason');",
                  "    pm.expect(jsonData).to.have.property('subReason');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('createdAt');",
                  "    pm.expect(jsonData).to.have.property('updatedAt');",
                  "});",
                  "",
                  "pm.test(\"Status is valid\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.be.oneOf(['open', 'inProgress', 'resolved']);",
                  "});",
                  "",
                  "pm.test(\"Amount is a positive number\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.amount).to.be.above(0);",
                  "});",
                  "",
                  "pm.test(\"Timestamps are valid ISO dates\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(new Date(jsonData.createdAt)).to.be.a('date');",
                  "    pm.expect(new Date(jsonData.updatedAt)).to.be.a('date');",
                  "});",
                  "",
                  "pm.test(\"Updated timestamp is not before created timestamp\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    const createdAt = new Date(jsonData.createdAt);",
                  "    const updatedAt = new Date(jsonData.updatedAt);",
                  "    pm.expect(updatedAt.getTime()).to.be.at.least(createdAt.getTime());",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Marcar reclamo como resuelto",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              },
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"comments\": \"Reclamo resuelto: Se ha confirmado que la transacción fue fraudulenta. Se ha reembolsado el monto completo a la cuenta del cliente y se han implementado medidas adicionales de seguridad.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/claims/{{claimId}}/resolve",
              "host": ["{{baseUrl}}"],
              "path": ["claims", "{{claimId}}", "resolve"]
            },
            "description": "Cambia el estado del reclamo a resuelto y añade comentarios de resolución detallando las acciones tomadas."
          },
          "response": [
            {
              "name": "Reclamo resuelto exitosamente",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Accept",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"comments\": \"Reclamo resuelto: Se ha confirmado que la transacción fue fraudulenta. Se ha reembolsado el monto completo a la cuenta del cliente y se han implementado medidas adicionales de seguridad.\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/claims/CLM-2024-001234/resolve",
                  "host": ["{{baseUrl}}"],
                  "path": ["claims", "CLM-2024-001234", "resolve"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\n  \"id\": \"CLM-2024-001234\",\n  \"date\": \"2024-11-08T10:30:00Z\",\n  \"amount\": 1500.75,\n  \"identityDocument\": \"12345678\",\n  \"description\": \"Cargo no autorizado en mi tarjeta de crédito por compra que no realicé\",\n  \"reason\": \"Cargo indebido\",\n  \"subReason\": \"Transacción no autorizada\",\n  \"status\": \"resolved\",\n  \"comments\": \"Reclamo resuelto: Se ha confirmado que la transacción fue fraudulenta. Se ha reembolsado el monto completo.\",\n  \"createdAt\": \"2024-11-08T10:30:00Z\",\n  \"updatedAt\": \"2024-11-08T16:30:00Z\"\n}"
            },
            {
              "name": "Datos de resolución inválidos",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"comments\": \"\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/claims/CLM-2024-001234/resolve",
                  "host": ["{{baseUrl}}"],
                  "path": ["claims", "CLM-2024-001234", "resolve"]
                }
              },
              "status": "Bad Request",
              "code": 400,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\n  \"error\": \"Invalid Resolution Data\",\n  \"message\": \"Los comentarios de resolución son requeridos\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Claim status is resolved\", function () {",
                  "    pm.response.to.be.json;",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.equal('resolved');",
                  "});",
                  "",
                  "pm.test(\"Comments are added\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.comments).to.not.be.null;",
                  "    pm.expect(jsonData.comments).to.not.be.empty;",
                  "    pm.expect(jsonData.comments.length).to.be.above(10);",
                  "});",
                  "",
                  "pm.test(\"Updated timestamp is newer than created\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    const createdAt = new Date(jsonData.createdAt);",
                  "    const updatedAt = new Date(jsonData.updatedAt);",
                  "    pm.expect(updatedAt.getTime()).to.be.above(createdAt.getTime());",
                  "});",
                  "",
                  "pm.test(\"Claim ID remains unchanged\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.id).to.match(/^CLM-\\d{4}-\\d{6}$/);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Importar reclamos desde archivo Excel",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "description": "Archivo Excel con los datos de los reclamos (.xlsx)",
                  "type": "file",
                  "src": []
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/claims/import",
              "host": ["{{baseUrl}}"],
              "path": ["claims", "import"]
            },
            "description": "Procesa un archivo Excel y crea múltiples reclamos basándose en los datos proporcionados. El archivo debe contener columnas para fecha, monto, documento, descripción, motivo y submotivo."
          },
          "response": [
            {
              "name": "Reclamos importados exitosamente",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "file",
                      "type": "file",
                      "src": "claims_import.xlsx"
                    }
                  ]
                },
                "url": {
                  "raw": "{{baseUrl}}/claims/import",
                  "host": ["{{baseUrl}}"],
                  "path": ["claims", "import"]
                }
              },
              "status": "Created",
              "code": 201,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\n  \"message\": \"Importación completada exitosamente\",\n  \"totalProcessed\": 25,\n  \"successful\": 23,\n  \"failed\": 2,\n  \"claimsCreated\": [\n    {\n      \"id\": \"CLM-2024-001240\",\n      \"identityDocument\": \"11111111\",\n      \"amount\": 500.00\n    },\n    {\n      \"id\": \"CLM-2024-001241\",\n      \"identityDocument\": \"22222222\",\n      \"amount\": 750.50\n    },\n    {\n      \"id\": \"CLM-2024-001242\",\n      \"identityDocument\": \"33333333\",\n      \"amount\": 1200.00\n    }\n  ],\n  \"errors\": [\n    {\n      \"row\": 5,\n      \"error\": \"Documento de identidad inválido\"\n    },\n    {\n      \"row\": 12,\n      \"error\": \"Monto requerido\"\n    }\n  ]\n}"
            },
            {
              "name": "Archivo inválido",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Accept",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "file",
                      "type": "file",
                      "src": "invalid.txt"
                    }
                  ]
                },
                "url": {
                  "raw": "{{baseUrl}}/claims/import",
                  "host": ["{{baseUrl}}"],
                  "path": ["claims", "import"]
                }
              },
              "status": "Bad Request",
              "code": 400,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "body": "{\n  \"error\": \"Invalid File\",\n  \"message\": \"El archivo debe ser un Excel válido (.xlsx)\"\n}"
            }
          ],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Response has import summary\", function () {",
                  "    pm.response.to.be.json;",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('message');",
                  "    pm.expect(jsonData).to.have.property('totalProcessed');",
                  "    pm.expect(jsonData).to.have.property('successful');",
                  "    pm.expect(jsonData).to.have.property('failed');",
                  "    pm.expect(jsonData).to.have.property('claimsCreated');",
                  "});",
                  "",
                  "pm.test(\"Processing counts are consistent\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.successful + jsonData.failed).to.equal(jsonData.totalProcessed);",
                  "});",
                  "",
                  "pm.test(\"Created claims have valid structure\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.claimsCreated).to.be.an('array');",
                  "    jsonData.claimsCreated.forEach(claim => {",
                  "        pm.expect(claim).to.have.property('id');",
                  "        pm.expect(claim).to.have.property('identityDocument');",
                  "        pm.expect(claim).to.have.property('amount');",
                  "        pm.expect(claim.id).to.match(/^CLM-\\d{4}-\\d{6}$/);",
                  "        pm.expect(claim.amount).to.be.above(0);",
                  "    });",
                  "});",
                  "",
                  "pm.test(\"Error entries have valid structure\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.errors && jsonData.errors.length > 0) {",
                  "        jsonData.errors.forEach(error => {",
                  "            pm.expect(error).to.have.property('row');",
                  "            pm.expect(error).to.have.property('error');",
                  "            pm.expect(error.row).to.be.a('number');",
                  "            pm.expect(error.error).to.be.a('string');",
                  "        });",
                  "    }",
                  "});",
                  "",
                  "pm.test(\"Success rate is reasonable\", function () {",
                  "    const jsonData = pm.response.json();",
                  "    const successRate = (jsonData.successful / jsonData.totalProcessed) * 100;",
                  "    pm.expect(successRate).to.be.above(0); // At least some success",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Script global que se ejecuta antes de cada request",
          "// Configuración de headers comunes y logging",
          "console.log('Ejecutando request a:', pm.request.url.toString());",
          "console.log('Método:', pm.request.method);",
          "",
          "// Set default headers if not already present",
          "if (pm.request.method !== 'GET' && !pm.request.headers.has('Content-Type')) {",
          "    pm.request.headers.add({",
          "        key: 'Content-Type',",
          "        value: 'application/json'",
          "    });",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Script global que se ejecuta después de cada response",
          "// Validaciones comunes para todas las respuestas",
          "pm.test(\"Response time is less than 15000ms\", function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(15000);",
          "});",
          "",
          "pm.test(\"Content-Type header is present\", function () {",
          "    pm.response.to.have.header(\"Content-Type\");",
          "});",
          "",
          "// Validación específica para respuestas JSON",
          "if (pm.response.headers.get('Content-Type').includes('application/json')) {",
          "    pm.test(\"Response is valid JSON\", function () {",
          "        pm.response.to.be.json;",
          "    });",
          "}",
          "",
          "// Validación específica para errores HTTP",
          "if (pm.response.code >= 400) {",
          "    pm.test(\"Error response has required structure\", function () {",
          "        pm.response.to.be.json;",
          "        const jsonData = pm.response.json();",
          "        pm.expect(jsonData).to.have.property('error');",
          "        pm.expect(jsonData).to.have.property('message');",
          "    });",
          "}",
          "",
          "// Log response for debugging",
          "console.log('Response Status:', pm.response.status);",
          "console.log('Response Time:', pm.response.responseTime + 'ms');"
        ]
      }
    }
  ]
}