<!-- Modal para crear rangos de crédito -->
@if (isVisible()) {
  <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
    <!-- Overlay -->
    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm" 
         (click)="close()">
    </div>
    
    <!-- Modal content -->
    <div class="relative w-full max-w-2xl bg-gray-50 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 max-h-[85vh] flex flex-col">
        
      <!-- Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200/50 flex-shrink-0">
        <div class="flex items-center">
          <div class="w-8 h-8 mr-3 rounded-lg bg-gradient-to-br from-blue-400 to-cyan-500 flex items-center justify-center">
            <i class="fas fa-medal text-white text-sm"></i>
          </div>
          <h2 class="text-xl font-bold text-gray-900">Nuevo Rango de Crédito</h2>
        </div>
        <button 
          (click)="close()"
          class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors duration-200">
          <i class="fas fa-times text-gray-600 text-sm"></i>
        </button>
      </div>

      <!-- Form content - scrollable -->
      <div class="flex-1 overflow-y-auto">
        <form (ngSubmit)="onSubmit()" class="p-6">
          <div class="space-y-8">
            
            <!-- ID del rango -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                ID del Rango <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <input
                  type="text"
                  [(ngModel)]="formData.id"
                  name="id"
                  required
                  maxlength="20"
                  (input)="validateIdInput($event)"
                  placeholder="ORO, PREMIUM_ELITE, PLATINO_VIP"
                  class="w-full px-4 py-3 pr-10 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 uppercase"
                  [class.border-red-500]="hasIdError()"
                  [class.border-green-500]="isIdValid() && formData.id.length > 0"
                  style="font-family: 'Courier New', monospace;">
                
                <!-- Icono de validación -->
                <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
                  @if (formData.id.length > 0) {
                    @if (hasIdError()) {
                      <i class="fas fa-exclamation-circle text-red-500"></i>
                    } @else if (isIdValid()) {
                      <i class="fas fa-check-circle text-green-500"></i>
                    }
                  }
                </div>
              </div>
              
              @if (hasIdError()) {
                <p class="text-sm text-red-600 mt-1 flex items-center">
                  <i class="fas fa-exclamation-circle text-xs mr-1"></i>
                  Formato inválido. Use solo MAYÚSCULAS, números y guión bajo (_)
                </p>
              } @else if (isIdValid() && formData.id.length > 0) {
                <p class="text-sm text-green-600 mt-1 flex items-center">
                  <i class="fas fa-check-circle text-xs mr-1"></i>
                  ID válido
                </p>
              } @else {
                <p class="text-sm text-blue-600 mt-1">
                  <i class="fas fa-info-circle text-xs mr-1"></i>
                  <strong>Formato:</strong> Solo MAYÚSCULAS, números y guión bajo. Ej: ORO, PREMIUM_ELITE
                </p>
              }
            </div>

            <!-- Nombre del rango -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Nombre del Rango <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                [(ngModel)]="formData.name"
                name="name"
                required
                maxlength="100"
                placeholder="ej: ORO, PREMIUM, PLATINO"
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200">
              <p class="text-sm text-gray-500 mt-2">
                Nombre descriptivo del rango
              </p>
            </div>

            <!-- Descripción -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Descripción <span class="text-red-500">*</span>
              </label>
              <textarea
                [(ngModel)]="formData.description"
                name="description"
                required
                maxlength="5000"
                rows="6"
                placeholder="Describe el perfil de cliente: ingresos, profesión, características económicas, criterios de elegibilidad, etc. Sea específico para que la IA pueda clasificar correctamente."
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 resize-none">
              </textarea>
              <div class="flex justify-between items-center mt-2">
                <p class="text-sm text-gray-500">
                  Descripción detallada para clasificación automática con IA
                </p>
                <span class="text-xs text-gray-400 bg-gray-50 px-2 py-1 rounded">
                  {{ formData.description.length || 0 }}/5000
                </span>
              </div>
            </div>

          </div>
        </form>
      </div>

      <!-- Footer con botones - fixed at bottom -->
      <div class="flex items-center justify-end gap-3 p-6 border-t border-gray-200/50 bg-gray-50 flex-shrink-0 rounded-b-2xl">
        <button
          type="button"
          (click)="close()"
          class="px-6 py-2.5 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-200">
          Cancelar
        </button>
        <button
          type="submit"
          (click)="onSubmit()"
          [disabled]="isSubmitting() || !isFormValid()"
          class="px-6 py-2.5 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
          @if (isSubmitting()) {
            <i class="fas fa-spinner fa-spin text-xs"></i>
          }
          {{ isSubmitting() ? 'Guardando...' : 'Crear Rango' }}
        </button>
      </div>
    </div>
  </div>
}