<!-- Modal Container -->
@if (show() && claim()) {
  <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <!-- Modal Content -->
    <div class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-white/30">
      
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200/50">
        <div class="flex items-center">
          <div class="w-8 h-8 mr-3 rounded-lg bg-gradient-to-br from-green-400 to-green-500 flex items-center justify-center">
            <i class="fas fa-check-circle text-white text-sm"></i>
          </div>
          <h2 class="text-xl font-bold text-gray-900">Resolver Reclamo</h2>
        </div>
        <button 
          (click)="onClose()" 
          class="w-8 h-8 rounded-lg bg-gray-100/80 hover:bg-gray-200/80 flex items-center justify-center transition-colors">
          <i class="fas fa-times text-gray-600"></i>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="p-6">
        
        <!-- Información del Reclamo -->
        <div class="bg-gray-50/50 backdrop-blur-sm rounded-xl p-4 mb-6 border border-gray-200/50">
          <h3 class="font-semibold text-gray-900 mb-4 flex items-center">
            <i class="fas fa-info-circle text-blue-500 mr-2"></i>
            Información del Reclamo
          </h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div>
              <span class="font-medium text-gray-700">ID Reclamo:</span>
              <span class="ml-2 text-gray-900 font-mono">{{ claim()!.id }}</span>
            </div>
            
            <div>
              <span class="font-medium text-gray-700">Estado Actual:</span>
              <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                    [ngClass]="{
                      'bg-orange-100 text-orange-800': claim()!.status === 'open',
                      'bg-blue-100 text-blue-800': claim()!.status === 'inProgress',
                      'bg-green-100 text-green-800': claim()!.status === 'resolved'
                    }">
                {{ getStatusLabel(claim()!.status) }}
              </span>
            </div>
            
            <div>
              <span class="font-medium text-gray-700">Documento:</span>
              <span class="ml-2 text-gray-900">{{ claim()!.identityDocument }}</span>
            </div>
            
            <div>
              <span class="font-medium text-gray-700">Monto:</span>
              <span class="ml-2 text-gray-900 font-semibold">{{ formatCurrency(claim()!.amount) }}</span>
            </div>
            
            <div>
              <span class="font-medium text-gray-700">Fecha:</span>
              <span class="ml-2 text-gray-900">{{ formatDate(claim()!.date) }}</span>
            </div>
            
            <div>
              <span class="font-medium text-gray-700">Motivo:</span>
              <span class="ml-2 text-gray-900">{{ claim()!.reason }}</span>
            </div>
          </div>
          
          <div class="mt-4">
            <span class="font-medium text-gray-700">Descripción:</span>
            <p class="mt-1 text-gray-900 text-sm bg-white/50 p-3 rounded-lg border border-gray-200/50">
              {{ claim()!.description }}
            </p>
          </div>
        </div>

        <!-- Formulario de Resolución -->
        <form #resolveFormRef="ngForm" (ngSubmit)="onSubmit(resolveFormRef)" class="space-y-6">
          
          <!-- Error Message -->
          @if (errorMessage()) {
            <div class="bg-red-50/80 border border-red-200 rounded-lg p-4">
              <div class="flex items-center">
                <i class="fas fa-exclamation-circle text-red-600 mr-2"></i>
                <span class="text-red-800 text-sm">{{ errorMessage() }}</span>
              </div>
            </div>
          }

          <!-- Comentarios de Resolución -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-comment-dots mr-2 text-gray-500"></i>
              Comentarios de Resolución *
            </label>
            <textarea
              name="comments"
              [(ngModel)]="resolutionForm.comments"
              placeholder="Describa detalladamente cómo se resolvió el reclamo, las acciones tomadas y los resultados obtenidos..."
              required
              minlength="10"
              maxlength="1000"
              rows="6"
              class="w-full px-4 py-3 rounded-xl border border-gray-300/60 bg-white/50 backdrop-blur-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all resize-none">
            </textarea>
            <p class="text-xs text-gray-500 mt-2">{{ resolutionForm.comments.length }}/1000 caracteres</p>
            <p class="text-xs text-gray-600 mt-1">
              <i class="fas fa-lightbulb text-yellow-500 mr-1"></i>
              Incluya detalles como: acciones correctivas, reembolsos realizados, medidas preventivas implementadas, etc.
            </p>
          </div>

          <!-- Modal Footer -->
          <div class="flex items-center justify-end gap-4 pt-6 border-t border-gray-200/50">
            <button
              type="button"
              (click)="onClose()"
              class="px-6 py-3 rounded-xl border border-gray-300/60 bg-white/50 text-gray-700 hover:bg-gray-50/80 transition-all font-medium">
              Cancelar
            </button>
            
            <button
              type="submit"
              [disabled]="!resolveFormRef.valid || isLoading()"
              class="px-6 py-3 rounded-xl bg-gradient-to-r from-green-500 to-green-600 text-white font-medium hover:from-green-600 hover:to-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2">
              @if (isLoading()) {
                <i class="fas fa-spinner fa-spin"></i>
                <span>Resolviendo...</span>
              } @else {
                <i class="fas fa-check-circle"></i>
                <span>Marcar como Resuelto</span>
              }
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
}